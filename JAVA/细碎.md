### pom.xmlæ–‡ä»¶
```xml
<dependency>  
  <groupId>junit</groupId>  
  <artifactId>junit</artifactId>  
  <version>3.8.1</version>  
  <scope>test</scope>  
</dependency>  

<!--springframework-->
<dependency>  
  <groupId>org.springframework</groupId>  
  <artifactId>spring-webmvc</artifactId>  
  <version>5.2.10.RELEASE</version>  
</dependency>  
  
<dependency>  
  <groupId>org.springframework</groupId>  
  <artifactId>spring-jdbc</artifactId>  
  <version>5.2.10.RELEASE</version>  
</dependency>  
  
<dependency>  
  <groupId>org.springframework</groupId>  
  <artifactId>spring-test</artifactId>  
  <version>5.2.10.RELEASE</version>  
</dependency>

<!--mybatis-->
<dependency>  
  <groupId>org.mybatis</groupId>  
  <artifactId>mybatis</artifactId>  
  <version>3.5.5</version>  
</dependency>  

<dependency>  
  <groupId>org.mybatis</groupId>  
  <artifactId>mybatis-spring</artifactId>  
  <version>1.3.0</version>  
</dependency>

  <!--mysql-->
<dependency>  
  <groupId>mysql</groupId>  
  <artifactId>mysql-connector-java</artifactId>  
  <version>8.0.33</version>  
</dependency>  
  
<!--servlet-->
<dependency>  
  <groupId>javax.servlet</groupId>  
  <artifactId>javax.servlet-api</artifactId>  
  <version>3.1.0</version>  
  <scope>provided</scope>  
</dependency>  

<!--druid-->
<dependency>
  <groupId>com.alibaba</groupId>
  <artifactId>druid</artifactId>
  <version>1.1.16</version>
</dependency>

<!--json-->
<dependency>  
  <groupId>com.fasterxml.jackson.core</groupId>  
  <artifactId>jackson-databind</artifactId>  
  <version>2.18.2</version>  
</dependency>

<!--jsp-->  
<dependency>  
  <groupId>javax.servlet.jsp</groupId>  
  <artifactId>jsp-api</artifactId>  
  <version>2.2</version>  
  <scope>provided</scope>  
</dependency>  
  
  
<!--jstl-->  
<dependency>  
  <groupId>jstl</groupId>  
  <artifactId>jstl</artifactId>  
  <version>1.2</version>  
</dependency>  
<dependency>  
  <groupId>taglibs</groupId>  
  <artifactId>standard</artifactId>  
  <version>1.1.2</version>  
</dependency>

<!--tomcat-->
<plugins>  
	<plugin>    
		<groupId>org.opoo.maven</groupId>  
		<artifactId>tomcat9-maven-plugin</artifactId>  
	    <version>3.0.1</version>  
	</plugin>
</plugins>
```
### 8080ç«¯å£è¢«å ç”¨
1. è¿›å…¥cmdï¼šnetstat -ano | findstr 8080
2. è¾“å‡ºç¤ºä¾‹ï¼ˆ`1234`Â æ˜¯è¿›ç¨‹ PIDï¼‰ï¼šTCP    0.0.0.0:8080           0.0.0.0:0              LISTENING       1234
3. ç»ˆæ­¢è¿›ç¨‹ï¼štaskkill /PID 1234 /F
### åˆ›å»ºresourcesä¸­çš„ç›®å½•ç»“æ„ ç”¨/
- com/aytoame/mapperï¼šcom.zytoame.mapperæ–‡ä»¶å¤¹ã€‚å°±æ˜¯resourcesæ–‡ä»¶å¤¹ä¸‹é¢çš„comæ–‡ä»¶å¤¹ä¸­çš„aytoameæ–‡ä»¶å¤¹ä¸­çš„mapperæ–‡ä»¶å¤¹
### é”™è¯¯ä¸­å‡ºç°< init>ï¼Œè¡¨ç¤ºæ²¡æœ‰æ„é€ æ–¹æ³•
### java.sql.SQLException: Field 'id' doesn't have a default value
æ•°æ®åº“ä¸­idå­—æ®µè®¾ç½®ä¸ºè‡ªå¢
### æ•°æ®åº“å†…å®¹ä¸ºnull
 **åç«¯æœªæ­£ç¡®æ¥æ”¶ JSON æ•°æ®**ï¼šSpring MVC æ§åˆ¶å™¨å¯èƒ½æ²¡æœ‰ä½¿ç”¨Â `@RequestBody`Â æ³¨è§£æ¥æ¥æ”¶ JSON æ•°æ®ã€‚
 åœ¨é¡µé¢æŒ‰ä¸‹f12æŸ¥çœ‹è°ƒè¯•çš„é”™è¯¯ï¼šconsole.log(row)ï¼›æ‰“å°ä¿¡æ¯è¿›è¡Œè°ƒè¯•
### å‰ç«¯åœ¨è°ƒç”¨Â `row.id`Â æ—¶å¾—åˆ°Â `undefined`ï¼Œè€Œå®é™…æ•°æ®å­˜å‚¨åœ¨Â `row.byId`Â ä¸­
 #### **åç«¯Â `Book`Â ç±»çš„ getter æ–¹æ³•å‘½åä¸è§„èŒƒ**
åœ¨Â `Book.java`Â ä¸­ï¼Œä½ å®šä¹‰äº†ä¸€ä¸ªÂ **`getById()`**Â æ–¹æ³•ï¼Œè€Œä¸æ˜¯æ ‡å‡†çš„Â **`getId()`**ï¼š
```java
public class Book {
    private int id;
    // âŒ éæ ‡å‡†å‘½åï¼Œä¼šå¯¼è‡´ JSON åºåˆ—åŒ–å­—æ®µåä¸º "byId"
    public int getById() {
        return id;
    }
    // âœ… åº”è¯¥æ”¹ä¸ºæ ‡å‡†å‘½å
    public int getId() {
        return id;
    }
}
```
- **åŸå› **ï¼š  
    Spring MVC é»˜è®¤ä½¿ç”¨Â **Jackson**Â åº“åºåˆ—åŒ–å¯¹è±¡ä¸º JSONï¼Œå­—æ®µåç”± getter æ–¹æ³•åå†³å®šï¼ˆå»æ‰Â `get`Â å¹¶é¦–å­—æ¯å°å†™ï¼‰ã€‚
    - `getById()`Â â†’ å­—æ®µåÂ `byId`
    - `getId()`Â â†’ å­—æ®µåÂ `id`

### (æ„é€ å™¨æ³¨å…¥ï¼‰å’ŒÂ ï¼ˆå­—æ®µæ³¨å…¥ï¼‰

| **ç‰¹æ€§**         | **æ„é€ å™¨æ³¨å…¥ (finalå­—æ®µ)**<br>`private final StringRedisTemplate stringRedisTemplate;` | **@Resourceå­—æ®µæ³¨å…¥**<br>`@Resource private StringRedisTemplate stringRedisTemplate;` |
| -------------- | ------------------------------------------------------------------------------- | --------------------------------------------------------------------------------- |
| **æ³¨å…¥æ–¹å¼**       | é€šè¿‡æ„é€ å™¨å‚æ•°å¼ºåˆ¶ä¼ å…¥                                                                     | Springé€šè¿‡åå°„ç›´æ¥è®¾ç½®å­—æ®µ                                                                  |
| **ä¸å¯å˜æ€§**       | æ”¯æŒ`final`ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰                                                                 | ä¸èƒ½å£°æ˜ä¸º`final`                                                                      |
| **ä¾èµ–æ˜ç¡®æ€§**      | ç±»ä¾èµ–å…³ç³»æ¸…æ™°å¯è§                                                                       | ä¾èµ–å…³ç³»éšè—åœ¨ç±»å†…éƒ¨                                                                        |
| **ç©ºå€¼æ£€æŸ¥**       | å¤©ç„¶é˜²æ­¢NPEï¼ˆæ„é€ å™¨å¼ºåˆ¶è¦æ±‚ï¼‰                                                                | å¯èƒ½å› é…ç½®é”™è¯¯å¯¼è‡´NPE                                                                      |
| **å¾ªç¯ä¾èµ–**       | èƒ½æš´éœ²è®¾è®¡é—®é¢˜ï¼ˆSpringä¼šæŠ¥é”™ï¼‰                                                              | èƒ½è‡ªåŠ¨å¤„ç†ï¼ˆä½†å¯èƒ½æ©ç›–è®¾è®¡ç¼ºé™·ï¼‰                                                                  |
| **æµ‹è¯•å‹å¥½æ€§**      | æ˜“äºmockï¼ˆç›´æ¥ä¼ å‚ï¼‰                                                                    | éœ€è¦åå°„æˆ–Springä¸Šä¸‹æ–‡                                                                    |
| **Springç‰ˆæœ¬æ”¯æŒ** | æ‰€æœ‰ç‰ˆæœ¬                                                                            | éœ€è¦Spring 2.5+                                                                     |
| **æ¨èç¨‹åº¦**       | **å®˜æ–¹æ¨è**ï¼ˆSpring 4.3+å¯çœç•¥`@Autowired`ï¼‰                                            | é€æ­¥è¢«æ·˜æ±°ï¼ˆå­˜åœ¨è®¾è®¡ç¼ºé™·ï¼‰                                                                     |
### é€»è¾‘å¤„ç†çš„å¼‚æ­¥ç¼“å­˜é‡å»º
#### 1.Â **`CompletableFuture.runAsync`Â è§£æ**

##### ğŸ“ŒÂ **ä»£ç ç»“æ„**

```java
CompletableFuture.runAsync(() -> {
    try {
        rebuildCache(id); // é‡å»ºç¼“å­˜
    } finally {
        unlock(lockKey); // ç¡®ä¿é”é‡Šæ”¾
    }
}, executor); // æŒ‡å®šçº¿ç¨‹æ± 
```

##### ğŸ”Â **æ ¸å¿ƒç‰¹æ€§**

|ç‰¹æ€§|è¯´æ˜|
|---|---|
|**å¼‚æ­¥æ‰§è¡Œ**|é€šè¿‡Â `CompletableFuture`Â å®ç°éé˜»å¡å¼‚æ­¥ä»»åŠ¡|
|**çº¿ç¨‹æ± æ§åˆ¶**|æ˜¾å¼æŒ‡å®šÂ `executor`Â é¿å…å ç”¨é»˜è®¤Â `ForkJoinPool`|
|**å¼‚å¸¸å¤„ç†**|åœ¨Â `try-finally`Â ä¸­ä¿è¯é”é‡Šæ”¾ï¼Œä½†å¼‚å¸¸éœ€é€šè¿‡Â `exceptionally`Â æ•è·|
|**é“¾å¼æ“ä½œ**|æ”¯æŒåç»­è°ƒç”¨Â `.thenRun()`ã€`.exceptionally()`Â ç­‰ç»„åˆæ“ä½œ|

##### âš ï¸Â **æ³¨æ„äº‹é¡¹**

- è‹¥Â `rebuildCache`Â æŠ›å‡ºå¼‚å¸¸ï¼Œéœ€é¢å¤–è°ƒç”¨Â `.exceptionally()`Â å¤„ç†ï¼Œå¦åˆ™å¼‚å¸¸ä¼šè¢«é™é»˜åå™¬ã€‚
    
- é»˜è®¤ä½¿ç”¨Â `ForkJoinPool.commonPool()`ï¼ˆæœªæŒ‡å®šÂ `executor`Â æ—¶ï¼‰ï¼Œé«˜å¹¶å‘åœºæ™¯å¯èƒ½é€ æˆèµ„æºç«äº‰ã€‚
    

---

#### 2.Â **`CACHE_REBUILD_EXECUTOR.submit`Â è§£æ**

##### ğŸ“ŒÂ **ä»£ç ç»“æ„**

```java
CACHE_REBUILD_EXECUTOR.submit(() -> {
    try {
        this.saveShop2Redis(id, 20L); // é‡å»ºç¼“å­˜
    } catch (Exception e) {
        throw new RuntimeException(e); // æ˜¾å¼æŠ›å‡ºå¼‚å¸¸
    } finally {
        unlock(lockKey); // ç¡®ä¿é”é‡Šæ”¾
    }
});
```

##### ğŸ”Â **æ ¸å¿ƒç‰¹æ€§**

|ç‰¹æ€§|è¯´æ˜|
|---|---|
|**åŸºäºçº¿ç¨‹æ± **|ç›´æ¥ä½¿ç”¨è‡ªå®šä¹‰çš„Â `ExecutorService`ï¼ˆå¦‚Â `ThreadPoolExecutor`ï¼‰|
|**å¼‚å¸¸å¤„ç†**|é€šè¿‡Â `try-catch`Â æ•è·å¼‚å¸¸å¹¶è½¬ä¸ºÂ `RuntimeException`ï¼Œé¿å…é™é»˜å¤±è´¥|
|**ä»»åŠ¡ç®¡ç†**|è¿”å›Â `Future<?>`Â å¯å–æ¶ˆä»»åŠ¡æˆ–æ£€æŸ¥çŠ¶æ€ï¼ˆä½†æ­¤å¤„æœªæ¥æ”¶è¿”å›å€¼ï¼‰|

##### âš ï¸Â **æ³¨æ„äº‹é¡¹**

- æŠ›å‡ºå¼‚å¸¸ä¼šå¯¼è‡´çº¿ç¨‹æ± ä»»åŠ¡ç»ˆæ­¢ï¼Œéœ€ç¡®ä¿çº¿ç¨‹æ± é…ç½®äº†åˆç†çš„Â `RejectedExecutionHandler`ã€‚
    
- æœªå¤„ç†Â `Future`Â è¿”å›å€¼æ—¶ï¼Œä»»åŠ¡ä¸­çš„å¼‚å¸¸å¯èƒ½è¢«å¿½ç•¥ï¼ˆéœ€é€šè¿‡çº¿ç¨‹æ± çš„Â `UncaughtExceptionHandler`Â æ•è·ï¼‰ã€‚
    

---

#### 3.Â **å…³é”®å¯¹æ¯”**

|**å¯¹æ¯”ç»´åº¦**|**`CompletableFuture.runAsync`**|**`ExecutorService.submit`**|
|---|---|---|
|**å¼‚å¸¸ä¼ æ’­**|éœ€æ‰‹åŠ¨è°ƒç”¨Â `.exceptionally()`Â å¤„ç†|ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼ˆéœ€çº¿ç¨‹æ± é…ç½®å¼‚å¸¸å¤„ç†å™¨ï¼‰|
|**çº¿ç¨‹æ± çµæ´»æ€§**|å¯åŠ¨æ€æŒ‡å®šä¸åŒçº¿ç¨‹æ± |éœ€æå‰åˆå§‹åŒ–å›ºå®šçº¿ç¨‹æ± |
|**ç»„åˆæ“ä½œ**|æ”¯æŒé“¾å¼è°ƒç”¨ï¼ˆå¦‚Â `.thenRun()`ï¼‰|ä»…æ”¯æŒå•ä¸€ä»»åŠ¡æäº¤|
|**ä»£ç ç®€æ´æ€§**|æ›´å‡½æ•°å¼é£æ ¼|ä¼ ç»Ÿå‘½ä»¤å¼é£æ ¼|
|**é€‚ç”¨åœºæ™¯**|éœ€è¦åç»­å¼‚æ­¥ç¼–æ’çš„åœºæ™¯ï¼ˆå¦‚å¤šä»»åŠ¡ä¾èµ–ï¼‰|ç®€å•å¼‚æ­¥ä»»åŠ¡ï¼ˆæ— éœ€ç»“æœæˆ–åç»­æ“ä½œï¼‰|

---

#### 4.Â **å¦‚ä½•é€‰æ‹©ï¼Ÿ**

##### âœ…Â **ä¼˜å…ˆé€‰æ‹©Â `CompletableFuture.runAsync`Â å½“ï¼š**

- éœ€è¦ä¸å…¶ä»–å¼‚æ­¥ä»»åŠ¡ç»„åˆï¼ˆå¦‚å¹¶è¡ŒæŸ¥è¯¢å¤šä¸ªç¼“å­˜ååˆå¹¶ç»“æœï¼‰ã€‚
    
- é¡¹ç›®å·²ä½¿ç”¨ Java 8+ å‡½æ•°å¼ç¼–ç¨‹é£æ ¼ã€‚
    
- éœ€è¦æ›´çµæ´»çš„çº¿ç¨‹æ± ç®¡ç†ï¼ˆå¦‚ä¸åŒä»»åŠ¡ç”¨ä¸åŒçº¿ç¨‹æ± ï¼‰ã€‚
    

##### âœ…Â **ä¼˜å…ˆé€‰æ‹©Â `ExecutorService.submit`Â å½“ï¼š**

- éœ€è¦ç›´æ¥æ§åˆ¶çº¿ç¨‹æ± è¡Œä¸ºï¼ˆå¦‚è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥ï¼‰ã€‚
    
- ä»£ç è¿è¡Œåœ¨æ—§ç‰ˆ Javaï¼ˆ< 8ï¼‰ç¯å¢ƒä¸­ã€‚
    
- ä»»åŠ¡ç®€å•ä¸”æ— éœ€åç»­å¼‚æ­¥ç¼–æ’ã€‚
    
---

#### 5.Â **å®Œæ•´æœ€ä½³å®è·µç¤ºä¾‹**

##### ğŸŒŸÂ **æ”¹è¿›åçš„Â `CompletableFuture`Â å®ç°ï¼ˆå¸¦å¼‚å¸¸å¤„ç†ï¼‰**

```java
CompletableFuture.runAsync(() -> {
    try {
        rebuildCache(id);
    } catch (Exception e) {
        log.error("ç¼“å­˜é‡å»ºå¤±è´¥, id: {}", id, e);
    } finally {
        unlock(lockKey);
    }
}, executor).exceptionally(e -> {
    log.error("å¼‚æ­¥ä»»åŠ¡å¼‚å¸¸", e);
    return null;
});
```

##### ğŸŒŸÂ **æ”¹è¿›åçš„Â `ExecutorService`Â å®ç°ï¼ˆå¸¦çº¿ç¨‹æ± ç›‘æ§ï¼‰**

```java
Future<?> future = CACHE_REBUILD_EXECUTOR.submit(() -> {
    try {
        this.saveShop2Redis(id, 20L);
    } finally {
        unlock(lockKey);
    }
});

// å¯é€‰ï¼šç›‘æ§ä»»åŠ¡çŠ¶æ€
if (future.isDone()) {
    try {
        future.get(); // æ£€æŸ¥æ˜¯å¦æŠ›å‡ºå¼‚å¸¸
    } catch (InterruptedException | ExecutionException e) {
        log.error("ç¼“å­˜é‡å»ºä»»åŠ¡å¼‚å¸¸", e);
    }
}
```

---

#### 6.Â **åº•å±‚åŸç†å¯¹æ¯”**

|**æœºåˆ¶**|**`CompletableFuture`**|**`ExecutorService`**|
|---|---|---|
|**ä»»åŠ¡è°ƒåº¦**|é€šè¿‡Â `ForkJoinPool`Â æˆ–è‡ªå®šä¹‰çº¿ç¨‹æ± æ‰§è¡Œ|ç›´æ¥ç”±é…ç½®çš„çº¿ç¨‹æ± æ‰§è¡Œ|
|**å¼‚å¸¸æ•è·**|ä¾èµ–Â `CompletionStage`Â çš„å›è°ƒå¤„ç†|ä¾èµ–Â `Future.get()`Â æˆ–çº¿ç¨‹æ± çš„å¼‚å¸¸å¤„ç†å™¨|
|**èµ„æºæ¶ˆè€—**|é»˜è®¤å…±äº«Â `commonPool`ï¼Œå¯èƒ½ç«äº‰èµ„æº|ç‹¬ç«‹çº¿ç¨‹æ± ï¼Œéš”ç¦»æ€§å¥½|
